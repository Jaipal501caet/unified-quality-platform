import { test, expect } from '@playwright/test';
import { ApiController } from '../../src/api/apiController';

test.describe('Phase 1: Hybrid Automation', () => {

  test('Should check API health and then login via UI', async ({ page, request }) => {
    
    // --- PART 1: API LAYER ---
    // We use the API Controller to do the backend setup/checks
    const api = new ApiController(request);
    await api.checkHealth();
    
    // Imagine we created a user here via API
    const user = await api.createUser('demo_user');

    // --- PART 2: UI LAYER ---
    // Now we switch to the browser to verify the frontend
    console.log('[UI] Navigating to Login Page...');
    await page.goto('/');

    // Perform Login
    // Note: Parabank demo app lets you log in with 'john'/'demo' usually, 
    // or we can just test the UI elements exist for this phase.
    await page.fill('input[name="username"]', 'john');
    await page.fill('input[name="password"]', 'demo');
    await page.click('input[value="Log In"]');

    // --- PART 3: VERIFICATION ---
    // Verify we are on the dashboard or saw an error
    // (For this specific demo site, 'john/demo' usually leads to an error or success depending on reset)
    // Let's just verify the page title to ensure UI driver is working.
    await expect(page).toHaveTitle(/ParaBank/);
    console.log('[UI] Page Title Verified');
  });
});
